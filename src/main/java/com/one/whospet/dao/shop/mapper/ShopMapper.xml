<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.one.whospet.dao.shop.face.ShopDao">

	<resultMap type="com.one.whospet.dto.Shop" id="Shop">
		<id column="s_no" property="sNo"/>
		
		<result column="u_no" property="uNo"/>
		<result column="s_name" property="sName"/>
		<result column="s_productType" property="sProductType"/>
		<result column="s_amount" property="sAmount"/>
		<result column="s_quantity" property="sQuantity"/>
		<result column="s_date" property="sDate"/>
		<result column="s_content" property="sContent"/>
	</resultMap>
	
	
	
	
	<resultMap type="com.one.whospet.dto.ShopImg" id="ShopImg">
		<id column="si_no" property="siNo"/>
		
		<result column="s_no" property="sNo"/>
		<result column="si_origin_filename" property="siOriginFilename"/>
		<result column="si_stored_filename" property="siStoredFilename"/>
		<result column="si_thumbnail" property="siThumbnail"/>
	</resultMap>





	<select id="selectCntAll" resultType="int">
		SELECT count(*) FROM w_shop
	</select>

	<!-- 상품리스트 -->
	<select id="selectPageList" parameterType="com.one.whospet.util.ShopPaging" resultMap="Shop">
		SELECT * FROM (
			SELECT ROWNUM rnum, S.* FROM (
				SELECT *
				FROM w_shop
				ORDER BY s_no desc
			) S
		) R
		WHERE rnum BETWEEN #{startNo} AND #{endNo}
	</select>
	
	<!-- 상품상세조회 -->
	<select id="selectShopBySno" parameterType="com.one.whospet.dto.Shop" resultMap="Shop">
		SELECT * FROM w_shop
		WHERE s_no = ${sNo}
	</select>
	
	<!-- 상품이미지 조회 -->
	<select id="selectShopImgBySNo" parameterType="int" resultMap="ShopImg">
		SELECT * FROM w_shop_img
		WHERE s_no = #{sNo} AND si_thumbnail = 'N'
	</select>

	<!-- 섬네일 상품이미지 조회 (상세보기) -->
	<select id="selectThumbnailBySNo" parameterType="int" resultMap="ShopImg">
		SELECT * FROM w_shop_img
		WHERE s_no = #{i} AND si_thumbnail = 'Y'
	</select>
	
	
	<!-- 상품 삽입하기 -->
	<insert id="insertShop" parameterType="com.one.whospet.dto.Shop">
		<selectKey order="BEFORE" resultType="int" keyProperty="sNo">
			SELECT w_shop_seq.nextval FROM dual
		</selectKey>
		
		INSERT INTO w_shop ( s_no, u_no, s_name, s_productType, s_amount, s_quantity, s_content )
		VALUES ( #{sNo} , #{uNo}, #{sName}, #{sProductType}, #{sAmount}, #{sQuantity}, #{sContent} )
	</insert>
	
	<!-- 상품이미지 삽입하기 -->
	<insert id="insertFile" parameterType="com.one.whospet.dto.ShopImg" >
		<selectKey order="BEFORE" resultType="int" keyProperty="siNo">
			SELECT w_shop_img_seq.nextval FROM dual
		</selectKey>
		
		INSERT INTO w_shop_img (si_no, s_no, si_origin_filename, si_stored_filename, si_thumbnail )
		VALUES ( #{siNo}, #{sNo}, #{siOriginFilename}, #{siStoredFilename}, #{siThumbnail} )
	</insert>
	
	<!-- 업데이트 시 상품정보 수정하기 -->
	<update id="updateShopInfo" parameterType="com.one.whospet.dto.Shop">
		UPDATE w_shop SET
		 s_name = #{sName},
		 s_productType = #{sProductType},
		 s_amount = #{sAmount},
		 s_quantity = #{sQuantity},
		 s_content = #{sContent} WHERE s_no = #{sNo}
	</update>
	
	<!-- 업데이트 시 x표시 누른 첨부파일 삭제하기 -->
	<delete id="deleteFileBySiNo" parameterType="int">
		DELETE FROM w_shop_img
		WHERE si_no = #{siNo}
	</delete>
	
	
	<delete id="deleteShopImgBySNo" parameterType="com.one.whospet.dto.Shop">
		DELETE FROM w_shop_img
		WHERE s_no = #{sNo}
	</delete>
	
	<delete id="deleteShopBySNo" parameterType="com.one.whospet.dto.Shop">
		DELETE FROM w_shop
		WHERE s_no = #{sNo}
	</delete>
	
</mapper>